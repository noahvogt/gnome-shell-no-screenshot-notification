From 8977ba4f23aef8754c0a912e7e1ec46f8da4776e Mon Sep 17 00:00:00 2001
From: Ionut Biru <ibiru@archlinux.org>
Date: Mon, 9 May 2011 13:03:17 -0700
Subject: [PATCH] Don't crash when removing nameless user

Fixes https://bugzilla.gnome.org/show_bug.cgi?id=647893

Signed-off-by: Ionut Biru <ibiru@archlinux.org>
---
 src/gdmuser/gdm-user-manager.c |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/src/gdmuser/gdm-user-manager.c b/src/gdmuser/gdm-user-manager.c
index eba9da1..543fcc3 100644
--- a/src/gdmuser/gdm-user-manager.c
+++ b/src/gdmuser/gdm-user-manager.c
@@ -777,7 +777,10 @@ remove_user (GdmUserManager *manager,
         if (gdm_user_get_object_path (user) != NULL) {
                 g_hash_table_remove (manager->priv->users_by_object_path, gdm_user_get_object_path (user));
         }
-        g_hash_table_remove (manager->priv->users_by_name, gdm_user_get_user_name (user));
+
+        if (gdm_user_get_user_name (user) != NULL) {
+            g_hash_table_remove (manager->priv->users_by_name, gdm_user_get_user_name (user));
+        }
 
         if (manager->priv->is_loaded) {
                 g_signal_emit (manager, signals[USER_REMOVED], 0, user);
-- 
1.7.5.1

